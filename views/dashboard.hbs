<div class="container-xl">
    <!-- Page title -->
    <div class="page-header d-print-none">
        <div class="row align-items-center">
            <div class="col">
                <!-- Page pre-title -->
                <h2 class="page-title">
                    Summary dashboard SIREDA
                </h2>
            </div>
            <!-- Page title actions -->
            <div class="col-auto ms-auto d-print-none">
                <div class="btn-list">
                    <a href="#" class="btn btn-primary btn-pill d-sm-none btn-icon" data-bs-toggle="modal"
                        data-bs-target="#modal-report" aria-label="Create new report">
                        <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24"
                            stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="page-body">
    <div class="container-xl">
        <div class="row row-deck row-cards">
            <div class="col-md-4">
                <div class="card">
                    <input type="hidden" class="saldo_digunakan" value="" />
                    <input type="hidden" class="sisa_saldos" value="" />
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader">Grandtotal (Anggaran awal)</div>
                            <div class="ms-auto lh-1">
                            </div>
                        </div>
                        <div class="h1 mb-3"></div>
                        <div class="d-flex mb-2">
                            <div class="h1 grandtotal"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader">Sisa Grandtotal (Sisa Anggaran)</div>
                            <div class="ms-auto lh-1">
                            </div>
                        </div>
                        <div class="h1 mb-3"></div>
                        <div class="d-flex mb-2">
                            <div class="h1 sisa_saldo">Rp. 0,00</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader">Total pengeluaran</div>
                            <div class="ms-auto lh-1">
                            </div>
                        </div>
                        <div class="h1 mb-3"></div>
                        <div class="d-flex mb-2">
                            <div class="h1 saldo_digunakan1">Rp. 0,00</div>
                        </div>
                    </div>
                </div>
            </div>
            {{!-- <div class="col-lg-12">
                <div class="row row-cards">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="card-title">Traffic summary</h3>
                                <div id="chart-mentions" class="chart-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> --}}
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Rekap list</h3>
                    </div>
                    <div class="card-body border-bottom py-3">
                        <div class="d-flex">
                            <div class="text-muted">
                                Show
                                <div class="mx-2 d-inline-block">
                                    <input type="text" class="form-control form-control-sm" value="8" size="3"
                                        aria-label="Invoices count">
                                </div>
                                entries
                            </div>
                            <div class="ms-auto text-muted">
                                Search:
                                <div class="ms-2 d-inline-block">
                                    <input type="text" class="form-control form-control-sm" aria-label="Search invoice">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table card-table table-vcenter text-nowrap datatable" id="riwayat_transaksi">
                            <thead>
                                <tr>
                                    <th class="w-1"><input class="form-check-input m-0 align-middle" type="checkbox"
                                            aria-label="Select all invoices"></th>
                                    <th class="w-1">No.
                                        <!-- Download SVG icon from http://tabler-icons.io/i/chevron-up -->
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="icon icon-sm text-dark icon-thick" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <polyline points="6 15 12 9 18 15" />
                                        </svg>
                                    </th>
                                    <th>Nama Pemilik</th>
                                    <th>Kode Rekening</th>
                                    <th>Sub Kegiatan</th>
                                    <th>Uraian</th>
                                    <th colspan="3">
                                        <center>Rincian Perhitungan</center>
                                    </th>
                                    <th>Jumlah</th>
                                    <th>Tanggal Dibuat</th>
                                </tr>
                            </thead>
                            <thead>
                                <tr>
                                    <th class="w-1" rowspan="2"></th>
                                    <th class="w-1" rowspan="2"></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th>Koefisien</th>
                                    <th>Satuan</th>
                                    <th>Harga</th>
                                    {{!-- <th>PPN</th> --}}
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer d-flex align-items-center">
                        </p>
                        <ul class="pagination m-0 ms-auto">
                            <div id="data-container"></div>
                            <div id="pagination-container"></div>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="assets/src/js/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // GET DATA REKENING
        $.ajax({
            'url': '/data_rekening/',
            'dataType': 'json',
            'method': 'get',
        }).done(function (data) {
            var sum = 0;
            $.each(data, function (index, value) {
                sum += parseFloat(value.saldo)
            })
            $('.sisa_saldos').val(sum)
            $('.sisa_saldo').html('Rp. ' + sum.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1."))
        })

        // GET DATA CASH
        var today = new Date();
        var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
        $.ajax({
            'url': '/data_cash/',
            'dataType': 'json',
            'method': 'get',
        }).done(function (data) {
            var sum = 0;
            $.each(data, function (index, value) {
                sum += parseFloat(value.total)
            })
            $(".saldo_digunakan").val(sum);
            $(".saldo_digunakan1").html('Rp. ' + sum.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1."));

            // GET DATA WITH PAGINATION
            $('#pagination-container').pagination({
                dataSource: data,
                callback: function (data, pagination) {
                    var body = []
                    $.each(data, function (index, value) {
                        body += '<tr>';
                        body += '<td><input class="form-check-input m-0 align-middle" type="checkbox" aria-label="Select invoice"></td>';
                        body += '<td><span class="text-muted">001401</span></td>';
                        body += '<td>' + value.user.name + '</td>';
                        body += '<td>' + value.kode_rekening + '</td>';
                        body += '<td>' + value.rekening.sub_kegiatan + '</td>';
                        body += '<td>' + value.uraian + '</td>';
                        body += '<td>' + value.koefisien + '</td>';
                        body += '<td>' + value.satuan + '</td>';
                        body += '<td>Rp. ' + value.harga.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1.") + '</td>';
                        //   body += '<td>' + value.ppn + '</td>';
                        body += '<td>Rp. ' + value.total.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1.") + '</td>';
                        body += '<td>' + value.createdAt + '</td>';
                        body += '<tr>';
                    })
                    $('#riwayat_transaksi > tbody').html(body)
                }
            })
        })

        var saldo_digunakan = $(".row-deck").find('.saldo_digunakan').val()
        var sisa_saldo = $(".row-deck").find('.sisa_saldos').val()
        var grandtotal = (parseFloat(saldo_digunakan) + parseFloat(sisa_saldo))
        $(".grandtotal").html('Rp. ' + grandtotal.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1."))
    })
</script>